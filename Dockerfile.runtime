FROM nginx:alpine

# Copy the static site
COPY site/.kobweb/site/ /usr/share/nginx/html/

# Replace the nginx config to use PORT environment variable
RUN echo 'events {} \n\
http { \n\
  server { \n\
    listen $PORT; \n\
    root /usr/share/nginx/html; \n\
    index index.html; \n\
    \n\
    location / { \n\
      try_files $uri $uri/ /index.html; \n\
    } \n\
  } \n\
}' > /etc/nginx/nginx.conf

EXPOSE 8080

CMD ["nginx", "-g", "daemon off;"]