# -------- Build Kobweb Application --------
FROM gradle:8.8-jdk17 AS builder

WORKDIR /app
COPY . .

RUN chmod +x ./gradlew
# Build the complete Kobweb application (frontend + backend)
RUN ./gradlew :site:kobwebBuild -PkobwebEnv=PROD --no-daemon

# -------- Runtime --------
FROM eclipse-temurin:17-jre
WORKDIR /app

# Copy the Kobweb server JAR
COPY --from=builder /app/site/.kobweb/server/*.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]